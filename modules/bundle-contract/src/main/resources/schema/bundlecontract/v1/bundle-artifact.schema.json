{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://veredict.dev/schema/bundle-contract/v1/bundle-artifact.schema.json",
  "title": "Veredict Bundle Artifact v1",
  "description": "Deterministic, transportable bundle artifact for Veredict Control Plane -> Data Plane communication.",
  "type": "object",
  "additionalProperties": false,

  "required": [
    "contractVersion",
    "bundleName",
    "bundleVersion",
    "createdAt",
    "bundleHash",
    "bundle"
  ],

  "properties": {
    "contractVersion": {
      "type": "string",
      "const": "bundle.v1",
      "description": "Bundle contract version identifier"
    },

    "bundleName": {
      "type": "string",
      "minLength": 1,
      "description": "Logical identifier of the bundle"
    },

    "bundleVersion": {
      "type": "string",
      "minLength": 1,
      "description": "Version of the bundle (semver-like, but not enforced)"
    },

    "createdAt": {
      "type": "string",
      "format": "date-time",
      "description": "ISO-8601 creation timestamp"
    },

    "bundleHash": {
      "type": "string",
      "pattern": "^[0-9a-f]{64}$",
      "description": "SHA-256 hex lowercase of the canonical hashable view"
    },

    "metadata": {
      "type": "object",
      "description": "Optional metadata for audit and traceability",
      "additionalProperties": false,
      "properties": {
        "tenant": {
          "type": "string",
          "minLength": 1
        },
        "author": {
          "type": "string",
          "minLength": 1
        },
        "notes": {
          "type": "string",
          "minLength": 1
        }
      }
    },

    "signature": {
      "type": "object",
      "description": "Optional signature slot (placeholder; not validated or enforced in v1)",
      "additionalProperties": false,
      "properties": {
        "algorithm": {
          "type": "string",
          "minLength": 1
        },
        "keyId": {
          "type": "string",
          "minLength": 1
        },
        "signature": {
          "type": "string",
          "minLength": 1
        }
      }
    },

    "bundle": {
      "type": "object",
      "description": "Rules payload based on dsl-model v1 (AST-only, engine-agnostic)",
      "additionalProperties": false,
      "required": ["rules"],
      "properties": {
        "rules": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "description": "DSL AST node (validated structurally in dsl-model, not here)"
          }
        }
      }
    }
  }
}
